<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.Author.Book.Manager.mapper.BookMapper">
    <select id="findAll">
        SELECT
            books.id,
            books.title,
            books.author_id AS authorId,
            books.published_year AS publishedYear,
            authors.name AS author,
            books.price,
            books.rating,
            books.category,
            books.cover_image AS coverImage,
            books.description,
            books.is_best_seller AS isBestSeller,
            books.review
        FROM books
        JOIN authors ON books.author_id = authors.id
        WHERE (#{category} = 'All' OR category = #{category})
        AND (
            books.title ILIKE CONCAT('%', #{searchValue}, '%')
            OR authors.name ILIKE CONCAT('%', #{searchValue}, '%')
            OR books.description ILIKE CONCAT('%', #{searchValue}, '%')
        );
    </select>
    <select id="findById">
        SELECT
            books.id,
            books.title,
            books.author_id AS authorId,
            books.published_year AS publishedYear,
            authors.name AS author,
            books.price,
            books.rating,
            books.category,
            books.cover_image AS coverImage,
            books.description,
            books.is_best_seller AS isBestSeller,
            books.review
        FROM books
        JOIN authors ON books.author_id = authors.id
        WHERE books.id = #{id};
    </select>
    <insert id="insert">
        INSERT INTO books
            (
                title,
                author_id,
                published_year,
                price,
                rating,
                category,
                cover_image,
                description,
                is_best_seller,
                review
            )
        values
            (
                #{title},
                #{authorId},
                #{publishedYear},
                #{price},
                #{rating},
                #{category},
                #{coverImage},
                #{description},
                #{isBestSeller},
                #{review}
            );
    </insert>
    <update id="update">
        UPDATE books SET published_year=#{publishedYear}, title=#{title}, author_id=#{authorId} where id=#{id}
    </update>
    <delete id="delete">
        DELETE FROM books WHERE id=#{id}
    </delete>
</mapper>